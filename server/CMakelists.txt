set(
  HANDLERS
  src/handlers/cwd_ftp.c
  src/handlers/delete.c
  src/handlers/greet.c
  src/handlers/list.c
  src/handlers/mkd_ftp.c
  src/handlers/passive.c
  src/handlers/port.c
  src/handlers/pwd_ftp.c
  src/handlers/quit.c
  src/handlers/rmd_ftp.c
  src/handlers/retrieve.c
  src/handlers/store.c
  src/handlers/util.c)
set(
  SERVER 
  ftpd.c
  src/util.c
  src/payload.c)
add_executable(ftpd ${SERVER} ${HANDLERS})
target_compile_options(ftpd PRIVATE -Wall -Wextra -pedantic -O3)
target_link_options(ftpd PRIVATE -fsanitize=address,undefined)
target_include_directories(ftpd PRIVATE .)
target_include_directories(ftpd PRIVATE include/handlers)

# import the libraries
# genereics
add_library(libgenerics STATIC IMPORTED)
set_target_properties(
  libgenerics
  PROPERTIES
  IMPORTED_LOCATION ${CMAKE_BINARY_DIR}/lib/generics/libgenerics.a
  INTERFACE_INCLUDE_DIRECTORIES ${CMAKE_SOURCE_DIR}/lib/generics/include
)

# properties
add_library(libproperties STATIC IMPORTED)
set_target_properties(
  libproperties
  PROPERTIES
  IMPORTED_LOCATION ${CMAKE_BINARY_DIR}/lib/properties/libproperties.a
  INTERFACE_INCLUDE_DIRECTORIES ${CMAKE_SOURCE_DIR}/lib/properties/include
)

# logger
add_library(liblogger STATIC IMPORTED)
set_target_properties(
  liblogger
  PROPERTIES
  IMPORTED_LOCATION ${CMAKE_BINARY_DIR}/lib/logger/liblogger.a
  INTERFACE_INCLUDE_DIRECTORIES ${CMAKE_SOURCE_DIR}/lib/logger/include
)

# thread_pool
add_library(libthread_pool STATIC IMPORTED)
set_target_properties(
  libthread_pool
  PROPERTIES
  IMPORTED_LOCATION ${CMAKE_BINARY_DIR}/lib/thread_pool/libthread_pool.a
  INTERFACE_INCLUDE_DIRECTORIES ${CMAKE_SOURCE_DIR}/lib/thread_pool/include
)

target_link_libraries(
  ftpd PRIVATE 
  libgenerics 
  libproperties
  liblogger
  libthread_pool
  pthread
)